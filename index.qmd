---
title: "Report"
execute: 
  echo: true      
code-fold: false  
---

Your report will go here.
```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
```
# RQ1: What do book-ins look like since 2017 through 2024? 

```{r}
# Calling Datasets

setwd("/Users/barrettedwards/Documents/GitHub/project-team-awesomest/data")
BookIns2017 <- read_csv("Book-Ins FY2017.csv")
BookIns2018 <- read_csv("Book-Ins FY2018.csv")
BookIns2019 <- read_csv("Book-Ins FY2019.csv")
BookIns2020 <- read_csv("Book-Ins FY2020.csv")
BookIns2021 <- read_csv("Book-Ins FY2021.csv")
BookIns2022 <- read_csv("Book-Ins FY2022.csv")
BookIns2023 <- read_csv("Book-Ins FY2023.csv")
BookIns2024 <- read_csv("Book-Ins FY2024.csv")
ICEBudget <- read_csv("ICE_Budget.csv")
```

```{r}
BookIns <- BookIns2017 |>
  full_join(BookIns2018) |>
  full_join(BookIns2019) |>
  full_join(BookIns2020) |>
  full_join(BookIns2021) |>
  full_join(BookIns2022) |>
  full_join(BookIns2023) |>
  full_join(BookIns2024) 

BookIns <- BookIns %>%
  mutate(Criminality = case_when(
    Criminality %in% c("Other Immigration Violator", "No Known Criminal Charges or Convictions") ~ 
      "Other Immigration Violator/No Known Criminal Charges or Convictions",
    TRUE ~ Criminality))
```

```{r}
# Visualizations On Book-Ins/Arrests Over Time

BookIns |>
  filter(Criminality %in% c("Total Arrests")) |>
  ggplot(aes(x = Year, y = Arrests)) + 
  geom_line() + 
  labs(title = "Total Arrests Over Time", x = "Year", y = "Number of Arrests")
```

```{r}
BookIns |>
   filter(Criminality != "Total Arrests") |>
  ggplot(aes(x = Year, y = Arrests)) + 
  geom_line() + 
    facet_wrap(~ Criminality, ncol = 1) +
  labs(title = "Arrests Over Time by Criminality", x = "Year", y = "Number of Arrests")
```

```{r}
ICEBudget <- ICEBudget |>
  rename(Budget = 'Budget (in millions)')
```

```{r}
ggplot(ICEBudget, aes(x = Year, y = Budget)) +
  geom_line()
```

```{r}
BookIns |>
  full_join(ICEBudget, by = "Year") |>
  filter(Criminality == "Total Arrests") |>
  ggplot(aes(x = Budget, y = Arrests, color = factor(Year))) +
  geom_point(size = 3) +
  labs(title = "Total Arrests vs. ICE Budget by Year",
       x = "ICE Budget",
       y = "Total Arrests",
       color = "Year") +
  theme_minimal()


```

```{r}
BookIns |>
  full_join(ICEBudget) |>
  filter(Criminality %in% c("Total Arrests")) |>
  ggplot(aes(x = Budget, y = Arrests)) + 
  geom_line()
```

# RQ2: 2019 Data

```{r}
# Calling Datasets

setwd("/Users/barrettedwards/Documents/GitHub/project-team-awesomest/data")
BookIns_2019 <- read_csv("ICE Initial Book-Ins by Arresting Agency and Month_ FY2019.csv")
```
```{r}
BookIns_2019 <- BookIns_2019 |>
  pivot_longer(
    cols = -Agency,          
    names_to = "Month",      
    values_to = "Count"      
  )
```

```{r}
# Fiscal year starts in October
month_order <- c("Oct", "Nov", "Dec", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep")

BookIns_2019 |> 
  filter(Month != "Total") |>
  mutate(Month = factor(Month, levels = month_order)) |>
  ggplot(aes(x = Month, y = Count, fill = Agency)) +
  geom_col(position = "dodge") +
  labs(title = "Agency Book-Ins by Month (2019)",
       x = "Month",
       y = "Count") +
  theme_minimal()
```



# RQ3: 2019 vs. 2024
```{r}
# Calling Datasets

setwd("/Users/barrettedwards/Documents/GitHub/project-team-awesomest/data")
BookIns_2024 <- read_csv("ICE Initial Book-Ins by Arresting Agency and Month_ EOFY2024.csv")
```

```{r}
BookIns_2019 <- BookIns_2019 |>
  mutate(Year = "2019")

BookIns_2024 <- BookIns_2024 |>
  pivot_longer(
    cols = -Agency,          
    names_to = "Month",      
    values_to = "Count"      
  ) |>
  mutate(Year = "2024")

BookIns_Comp <- BookIns_2024 |>
  full_join(BookIns_2019)
```

```{r}
BookIns_Comp |> 
  filter(Month != "Total", Agency == "ICE") |>
  mutate(Month = factor(Month, levels = month_order)) |>
  ggplot(aes(x = Month, y = Count, fill = Agency)) +
  geom_col(position = "dodge") +
  facet_wrap(~ Year) +
  labs(title = "Agency Book-Ins by Month",
       x = "Month",
       y = "Count") +
  theme_minimal()

BookIns_Comp |> 
  filter(Month != "Total") |>
  mutate(Month = factor(Month, levels = month_order)) |>
  ggplot(aes(x = Month, y = Count, fill = Agency)) +
  geom_col(position = "dodge") +
  facet_wrap(~ Year) +
  labs(title = "Agency Book-Ins by Month",
       x = "Month",
       y = "Count") +
  theme_minimal()
```

# RQ4: 2025 so far 

```{r}
#Load Data
library(readr)
Detention_Data_2025 <- read_csv("~/Desktop/FY2025 - Daily Detention Population  - Sheet1.csv")

Detention_Data_2025
```

```{r}
### Create Time-Series Line Chart ### 

#Download Libraries 
library(ggplot2)
library(dplyr)
library(tidyr) 

# Define The Order Of Month
month_levels <- c("October", "November", "December", "January", "February", "March")

# Ensure 'Month' in the original dataframe is also an ordered factor with these levels
Detention_Data_2025$Month <- factor(Detention_Data_2025$Month, levels = month_levels, ordered = TRUE)
all_agencies <- unique(Detention_Data_2025$Agency)
all_criminalities <- unique(Detention_Data_2025$Criminality)

# Create a complete grid of all combinations
complete_grid <- expand_grid(Month = factor(month_levels, levels = month_levels, ordered = TRUE),
                              Agency = all_agencies,
                              Criminality = all_criminalities)

# Calculate the total Daily Population
detention_total_criminality_agency <- Detention_Data_2025 %>%
  group_by(Month, Agency, Criminality) %>%
  summarise(Total_Daily_Population = sum(`Daily Population`, na.rm = TRUE), .groups = 'drop') %>%
  ungroup()

# Left-join the summarized data to the complete grid
detention_complete_data <- complete_grid %>%
  left_join(detention_total_criminality_agency, by = c("Month", "Agency", "Criminality")) %>%
  replace_na(list(Total_Daily_Population = 0)) 

# Create the time series line chart faceted by Agency
ggplot(detention_complete_data,
       aes(x = Month, y = Total_Daily_Population, color = Criminality, group = Criminality)) +
  geom_line(linewidth = 0.8) +
  geom_point(size = 2) +
  facet_wrap(~ Agency, ncol = 1) + 
  labs(
    title = "Detention Population by Criminality (FY2025)",
    subtitle = "Faceted by Agency (CBP, ICE, Average)",
    x = "Month",
    y = "Total Daily Population",
    color = "Criminality Type") +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5, color = "gray50"),
    axis.title.x = element_text(face = "bold", size = 10),
    axis.title.y = element_text(face = "bold", size = 1))


ggsave("detention_trends_taller.png",
       plot = ggplot, # Replace with the name of your ggplot object
       width = 8, # Adjust width as needed (in inches)
       height = 10, # Increase height to make it taller (in inches)
       units = "in",
       dpi = 300)
```

```{r}
### Make Vizualization For FY 2019 Facility Type ###

#Import Data
library(readr)
ice_facility_data <- read_csv("data/FY2019 - Facility Types Data  - Sheet1.csv")

ice_facility_data
```
```{r}
library(ggplot2)
library(dplyr)

# Assuming your dataframe is named 'ice_facility_data'

# Filter data for only FRC facilities
frc_data <- ice_facility_data %>%
  filter(`Facility Type` == "FRC")

# Ensure 'Month' is an ordered factor with all relevant months
month_levels <- c("October", "November", "December", "Janurary", "February", "March", "April", "May", "June", "July", "August", "September")
frc_data$Month <- factor(frc_data$Month, levels = month_levels, ordered = TRUE)

# Create the line chart for FRC facilities
ggplot(frc_data, aes(x = Month, y = `ICE Daily Population`, group = 1)) +
  geom_line(linewidth = 1.2, color = "steelblue") + # Use a distinct color
  geom_point(size = 3, color = "steelblue") +
  labs(
    title = "ICE Daily Population at FRC Facilities Over Time",
    x = "Month",
    y = "ICE Daily Population",
    caption = "Source: Your Data Source" # Replace with your actual data source
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    axis.title.x = element_text(face = "bold", size = 12),
    axis.title.y = element_text(face = "bold", size = 12)
  )
```

```{r}
# Load necessary libraries
library(ggplot2)
library(dplyr)
library(readr)

# Assuming your text file data is saved as 'length_of_stay_data.txt'
# Read the data, handling potential issues with inconsistent commas
length_of_stay_data <- read_delim("~/Documents/GitHub/project-team-awesomest/data/length_of_stay_data", delim = ",", show_col_types = FALSE)

length_of_stay_data
```

```{r}
library(ggplot2)
library(dplyr)
library(readr)

# Define the allowed criminality categories
allowed_criminalities <- c("Convicted Criminal", "Pending Criminal Charges", "Other Immigration Violator")

# Filter the data frame to keep only rows with the allowed criminality values
length_of_stay_data <- length_of_stay_data %>%
  filter(Criminality %in% allowed_criminalities)

# 1. Calculate the average Length of Stay by Year and Criminality
avg_stay_by_year_criminality <- length_of_stay_data %>%
  group_by(Year, Criminality) %>%
  summarise(Avg_Length_of_Stay = mean(`Length of Stay`, na.rm = TRUE), .groups = 'drop')

# 2. Create the grouped bar chart by Year
ggplot(avg_stay_by_year_criminality, aes(x = as.factor(Year), y = Avg_Length_of_Stay, fill = Criminality)) +
  geom_bar(stat = "identity", position = "dodge") + # Use 'dodge' to group bars
  labs(
    title = "Average Length of Stay by Year and Criminality",
    x = "Year",
    y = "Average Length of Stay (Days)",
    fill = "Criminality"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom"
  )
```

